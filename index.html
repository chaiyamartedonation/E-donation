<!DOCTYPE html>
<html lang="th" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏∏‡∏ç</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/countup.js@2.0.7/dist/countUp.umd.min.js"></script>

    <!-- Firebase v8 SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f1f5f9;
        }

        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
        }

        .glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .sidebar {
            background: rgba(25, 28, 44, 0.5);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-link {
            color: #e2e8f0;
            transition: all 0.2s ease-in-out;
            border-left: 4px solid transparent;
        }
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        .nav-link.active {
            border-left-color: #818cf8; /* indigo-400 */
            background-color: rgba(79, 70, 229, 0.3);
            color: white;
        }

        .header-title { color: #1e293b; }
        .header-subtitle { color: #475569; }

        .tab-content, .dashboard-sub-content { display: none; }
        .tab-content.active, .dashboard-sub-content.active { display: block; }
        input:disabled, select:disabled, button:disabled { background-color: #e5e7eb; cursor: not-allowed; opacity: 0.7; }
        .dashboard-nav-link { border-color: transparent; transition: all 0.2s ease-in-out; color: #6b7280; }
        .dashboard-nav-link.active { border-color: #4f46e5; color: #4338ca; } /* indigo-600, indigo-700 */

        .home-total-card {
            background: rgba(79, 70, 229, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="background-animation"></div>

    <div class="relative min-h-screen md:flex">
        <!-- Mobile menu overlay -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>

        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="sidebar w-64 shadow-xl flex-shrink-0 fixed inset-y-0 left-0 z-40 transform -translate-x-full transition-transform duration-300 ease-in-out md:relative md:translate-x-0">
            <div class="p-4 text-center border-b border-gray-700/50 flex flex-col items-center">
                <img src="https://img2.pic.in.th/pic/-Ver.3-1.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå" class="h-24 w-24">
                <h1 class="text-xl font-bold text-white mt-2">‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå</h1>
                <div class="w-full p-4">
                    <button id="login-btn" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Login</span>
                    </button>
                     <button id="logout-btn" class="hidden w-full bg-red-600 text-white font-bold py-2 px-4 rounded-md hover:bg-red-700 transition duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
            <nav class="mt-2">
                <!-- User/Donor Section -->
                <div>
                    <h2 class="text-xs font-semibold text-gray-400 uppercase px-6 mb-2">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</h2>
                    <div class="flex flex-col space-y-1">
                        <button class="nav-link active w-full text-left py-3 px-6 flex items-center space-x-3" data-tab="home">
                            <i class="fas fa-home w-5 text-center"></i>
                            <span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
                        </button>
                        <button class="nav-link w-full text-left py-3 px-6 flex items-center space-x-3" data-tab="donate">
                            <i class="fas fa-donate w-5 text-center"></i>
                            <span>‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                        </button>
                        <button class="nav-link w-full text-left py-3 px-6 flex items-center space-x-3" data-tab="request-receipt">
                            <i class="fas fa-file-invoice-dollar w-5 text-center"></i>
                            <span>‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</span>
                        </button>
                    </div>
                </div>
                
                <hr class="my-6 border-gray-700/50">

                <!-- Staff Section (Hidden by default) -->
                <div id="staff-menu" class="hidden">
                    <h2 class="text-xs font-semibold text-gray-400 uppercase px-6 mb-2">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h2>
                    <div class="flex flex-col space-y-1">
                         <button class="nav-link w-full text-left py-3 px-6 flex items-center space-x-3" data-tab="record">
                            <i class="fas fa-edit w-5 text-center"></i>
                            <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</span>
                        </button>
                        <button class="nav-link w-full text-left py-3 px-6 flex items-center space-x-3" data-tab="dashboard">
                            <i class="fas fa-chart-pie w-5 text-center"></i>
                            <span>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</span>
                        </button>
                        <button class="nav-link w-full text-left py-3 px-6 flex items-center space-x-3" data-tab="announcer">
                            <i class="fas fa-bullhorn w-5 text-center"></i>
                            <span>‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                        </button>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 p-4 md:p-10 overflow-y-auto">
             <header class="relative text-center mb-8">
                <button id="menu-btn" class="absolute top-0 left-0 md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 z-20">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
                <h1 class="header-title text-3xl md:text-4xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏∏‡∏ç</h1>
                <p class="header-subtitle mt-2">‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</p>
            </header>
            <main>
                 <!-- Home Section -->
                 <div id="home" class="tab-content active">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Main total amount display -->
                        <div class="lg:col-span-2 home-total-card text-white rounded-xl shadow-2xl p-8 flex flex-col justify-center items-center">
                            <h2 class="text-3xl font-semibold opacity-80">‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                            <p id="home-total-amount" class="text-7xl xl:text-8xl font-bold my-4 tracking-tight">‡∏ø 0.00</p>
                            <p class="opacity-80">‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡πÇ‡∏°‡∏ó‡∏ô‡∏≤‡∏ö‡∏∏‡∏ç‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô</p>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8 w-full max-w-md">
                                <button id="home-donate-btn" class="bg-green-500 text-white font-bold py-4 px-6 rounded-lg hover:bg-green-600 transition duration-300 flex items-center justify-center space-x-3 text-xl">
                                    <i class="fas fa-donate"></i>
                                    <span>‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</span>
                                </button>
                                 <button id="home-receipt-btn" class="bg-blue-500 text-white font-bold py-4 px-6 rounded-lg hover:bg-blue-600 transition duration-300 flex items-center justify-center space-x-3 text-xl">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                    <span>‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</span>
                                </button>
                            </div>
                        </div>
        
                        <!-- Recent donations list -->
                        <div class="glass rounded-xl shadow-lg p-6 flex flex-col">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                            <div id="recent-donations-list" class="space-y-3 flex-grow max-h-[70vh] overflow-y-auto">
                                <p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Section 1: Online Donation -->
                <div id="donate" class="tab-content">
                     <div class="card glass p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="card-title text-xl md:text-2xl font-bold mb-6 border-b-2 pb-4 flex items-center space-x-3">
                            <i class="fas fa-donate text-indigo-600"></i>
                            <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                             <!-- QR Code Section -->
                            <div class="flex flex-col items-center justify-center p-6 rounded-lg">
                                <h3 class="text-xl font-semibold mb-4 text-gray-700">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</h3>
                                <img src="https://img2.pic.in.th/pic/099400240646898.png" alt="QR Code for Donation" class="w-64 h-64 object-contain rounded-md shadow-lg">
                                <p class="mt-4 text-center text-gray-700">‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</p>
                            </div>
                            <!-- Donation Form -->
                            <form id="donate-form">
                                <div class="space-y-6">
                                    <div>
                                        <label for="donor-name-1" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                        <input type="text" id="donor-name-1" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                                    </div>
                                    <div>
                                        <label for="amount-1" class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ (‡∏ö‡∏≤‡∏ó)</label>
                                        <input type="number" id="amount-1" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                        <div class="space-y-2">
                                            <div class="flex items-center"><input type="radio" name="donation-type-1" value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" checked> <span class="ml-3 text-gray-700">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ô‡∏≥‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-1" value="‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-3 text-gray-700">‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-1" value="‡πÇ‡∏£‡∏á‡∏ó‡∏≤‡∏ô" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-3 text-gray-700">‡πÇ‡∏£‡∏á‡∏ó‡∏≤‡∏ô</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-1" value="‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"> <span class="ml-3 text-gray-700">‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</span></div>
                                            <div class="flex items-center">
                                                <input type="radio" name="donation-type-1" value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                                <span class="ml-3 text-gray-700">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</span>
                                                <input type="text" id="other-type-1" class="ml-2 flex-grow p-2 border rounded-md" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏">
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="notes-1" class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                                        <textarea id="notes-1" rows="3" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                                    </div>
                                    <div>
                                        <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center justify-center space-x-2">
                                            <i class="fas fa-paper-plane"></i>
                                            <span>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Record Donation -->
                <div id="record" class="tab-content">
                     <div class="card glass p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="card-title text-xl md:text-2xl font-bold mb-6 border-b-2 pb-4 flex items-center space-x-3">
                            <i class="fas fa-edit text-indigo-600"></i>
                            <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà)</span>
                        </h2>
                        <form id="record-form" class="space-y-8">
                            <!-- Part 1: Donor Info -->
                            <fieldset class="border p-6 rounded-md">
                                <legend class="text-lg font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</legend>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                    <div>
                                        <label for="donor-type-2" class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                        <select id="donor-type-2" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                            <option>‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</option>
                                            <option>‡∏ô‡∏¥‡∏ï‡∏¥‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="id-number-2" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß (13 ‡∏´‡∏•‡∏±‡∏Å)</label>
                                        <input disabled type="text" id="id-number-2" class="w-full p-3 border border-gray-300 rounded-md">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="org-name-2" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• / ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</label>
                                        <input type="text" id="org-name-2" class="w-full p-3 border border-gray-300 rounded-md" required>
                                    </div>
                                    <div>
                                        <label for="phone-2" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å)</label>
                                        <input disabled type="text" id="phone-2" class="w-full p-3 border border-gray-300 rounded-md">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="notes-2" class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                                        <textarea id="notes-2" rows="3" class="w-full p-3 border border-gray-300 rounded-md"></textarea>
                                    </div>
                                </div>
                            </fieldset>

                            <!-- Part 2: Donation Details -->
                            <fieldset class="border p-6 rounded-md">
                                <legend class="text-lg font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</legend>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                        <div class="flex flex-wrap gap-4">
                                            <div class="flex items-center"><input type="radio" name="donation-type-2" value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î" checked class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-2" value="‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-2" value="‡πÇ‡∏£‡∏á‡∏ó‡∏≤‡∏ô" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡πÇ‡∏£‡∏á‡∏ó‡∏≤‡∏ô</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-2" value="‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-2" value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</span> <input type="text" id="other-type-2" class="ml-2 p-1 border rounded-md"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="amount-2" class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó) / ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á</label>
                                        <input type="number" id="amount-2" class="w-full p-3 border border-gray-300 rounded-md" required>
                                    </div>
                                    <div>
                                        <label for="purpose-2" class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                        <select id="purpose-2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                            <option selected>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏ó‡∏ö‡∏Å‡∏ê‡∏¥‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2568</option>
                                            <option>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                            <option disabled>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ô‡∏°‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏∞‡∏ò‡∏≤‡∏ï‡∏∏‡∏Ø ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2569</option>
                                        </select>
                                    </div>
                                </div>
                            </fieldset>

                            <!-- Part 3: Documentation -->
                            <fieldset class="border p-6 rounded-md">
                                <legend class="text-lg font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</legend>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</label>
                                        <div class="flex space-x-6">
                                            <div class="flex items-center">
                                                <input type="radio" id="receipt-yes" name="receipt-request" value="yes" class="h-4 w-4 text-indigo-600">
                                                <label for="receipt-yes" class="ml-2 text-gray-700">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input type="radio" id="receipt-no" name="receipt-request" value="no" checked class="h-4 w-4 text-indigo-600">
                                                <label for="receipt-no" class="ml-2 text-gray-700">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-end">
                                        <label class="block text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô:</label>
                                        <span id="status-display" class="ml-2 font-bold text-lg text-green-600">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>
                                    </div>
                                </div>
                            </fieldset>

                            <div class="text-right">
                                <button type="submit" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center justify-center space-x-2">
                                    <i class="fas fa-save"></i>
                                    <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Section 3: Request Tax Receipt -->
                <div id="request-receipt" class="tab-content">
                     <div class="card glass p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="card-title text-xl md:text-2xl font-bold mb-6 border-b-2 pb-4 flex items-center space-x-3">
                            <i class="fas fa-file-invoice-dollar text-indigo-600"></i>
                            <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</span>
                        </h2>
                        <form id="request-receipt-form" class="space-y-8">
                            <fieldset class="border p-6 rounded-md">
                                <legend class="text-lg font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</legend>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                    <div>
                                        <label for="tax-id-3" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ (13 ‡∏´‡∏•‡∏±‡∏Å)</label>
                                        <input type="text" id="tax-id-3" maxlength="13" class="w-full p-3 border border-gray-300 rounded-md" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ (13 ‡∏´‡∏•‡∏±‡∏Å)" required>
                                    </div>
                                    <div>
                                        <label for="fullname-3" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                                        <input type="text" id="fullname-3" class="w-full p-3 border border-gray-300 rounded-md" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" required>
                                    </div>
                                    <div>
                                        <label for="phone-3" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                        <input type="text" id="phone-3" maxlength="10" class="w-full p-3 border border-gray-300 rounded-md" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" required>
                                    </div>
                                </div>
                            </fieldset>

                            <fieldset class="border p-6 rounded-md">
                                <legend class="text-lg font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</legend>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                        <div class="flex flex-wrap gap-4">
                                            <div class="flex items-center"><input type="radio" name="donation-type-3" value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î" checked class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-3" value="‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-3" value="‡πÇ‡∏£‡∏á‡∏ó‡∏≤‡∏ô" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡πÇ‡∏£‡∏á‡∏ó‡∏≤‡∏ô</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-3" value="‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</span></div>
                                            <div class="flex items-center"><input type="radio" name="donation-type-3" value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ" class="h-4 w-4 text-indigo-600"> <span class="ml-2 text-gray-700">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</span> <input type="text" id="other-type-3" class="ml-2 p-1 border rounded-md"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="amount-3" class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô/‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                                        <input type="number" id="amount-3" class="w-full p-3 border border-gray-300 rounded-md" required>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="notes-3" class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                                        <textarea id="notes-3" rows="3" class="w-full p-3 border border-gray-300 rounded-md"></textarea>
                                    </div>
                                </div>
                            </fieldset>

                            <fieldset class="border p-6 rounded-md bg-yellow-100 border-yellow-200">
                                <legend class="text-lg font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö</legend>
                                <div class="space-y-4 mt-4">
                                    <div class="flex items-start">
                                        <input id="consent-revenue" name="consent-revenue" type="checkbox" class="h-5 w-5 mt-1 text-indigo-600 border-gray-300 rounded">
                                        <label for="consent-revenue" class="ml-3 text-gray-700">‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏°‡∏™‡∏£‡∏£‡∏û‡∏≤‡∏Å‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</label>
                                    </div>
                                    <div class="flex items-start">
                                        <input id="consent-truth" name="consent-truth" type="checkbox" class="h-5 w-5 mt-1 text-indigo-600 border-gray-300 rounded">
                                        <label for="consent-truth" class="ml-3 text-gray-700">‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£</label>
                                    </div>
                                </div>
                            </fieldset>

                            <div class="text-right">
                                <button id="submit-receipt-request" type="submit" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center justify-center space-x-2" disabled>
                                    <i class="fas fa-file-import"></i>
                                    <span>‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Section 4: Dashboard -->
                <div id="dashboard" class="tab-content">
                     <div class="card glass p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="card-title text-xl md:text-2xl font-bold border-b-2 pb-4 mb-8 flex items-center space-x-3">
                            <i class="fas fa-chart-pie text-indigo-600"></i>
                            <span>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• Dashboard</span>
                        </h2>
                        
                        <!-- Stats Cards -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                            <div class="bg-blue-100 p-6 rounded-lg shadow">
                                <h3 class="text-blue-700 text-sm font-medium">‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)</h3>
                                <p id="total-donation-amount" class="text-3xl font-bold text-gray-900">‡∏ø 0.00</p>
                            </div>
                            <div class="bg-green-100 p-6 rounded-lg shadow">
                                <h3 class="text-green-700 text-sm font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ (‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)</h3>
                                <p id="total-donors" class="text-3xl font-bold text-gray-900">0 ‡∏Ñ‡∏ô</p>
                            </div>
                            <div class="bg-red-100 p-6 rounded-lg shadow">
                                <h3 class="text-red-700 text-sm font-medium">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</h3>
                                <p id="total-receipt-requests" class="text-3xl font-bold text-gray-900">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            </div>
                            <div class="bg-orange-100 p-6 rounded-lg shadow">
                                <h3 class="text-orange-800 text-sm font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                                <p id="pending-receipts" class="text-3xl font-bold text-gray-900">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            </div>
                        </div>

                        <!-- Dashboard Sub-navigation -->
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex flex-wrap space-x-8" aria-label="Tabs">
                                <button class="dashboard-nav-link active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-subtab="recorded">
                                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                                </button>
                                <button class="dashboard-nav-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-subtab="online">
                                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
                                </button>
                                <button class="dashboard-nav-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-subtab="requests">
                                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ
                                </button>
                            </nav>
                        </div>

                        <!-- Dashboard Sub-content -->
                        <div class="mt-8">
                            <div id="dashboard-recorded" class="dashboard-sub-content active">
                                <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                                    <h3 class="text-xl font-semibold text-gray-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
                                    <div class="flex flex-wrap items-center justify-end space-x-2 gap-y-2 w-full md:w-auto">
                                        <input type="text" id="search-recorded" class="border rounded px-3 py-1 w-full md:w-auto" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤... (‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á)">
                                        <input type="text" id="start-date-recorded" class="date-filter border rounded px-2 py-1 w-36" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
                                        <input type="text" id="end-date-recorded" class="date-filter border rounded px-2 py-1 w-36" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î">
                                        <button class="print-btn bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center space-x-2" data-table-id="dashboard-table-recorded-body" data-title="‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å">
                                            <i class="fas fa-print"></i>
                                            <span>‡∏û‡∏¥‡∏°‡∏û‡πå</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="overflow-x-auto border rounded-lg">
                                    <table class="min-w-full">
                                        <!-- ‚ùáÔ∏è MODIFIED: Table Head updated ‚ùáÔ∏è -->
                                        <thead class="table-header">
                                            <tr>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dashboard-table-recorded-body" class="divide-y divide-gray-200 bg-white">
                                            <!-- ‚ùáÔ∏è MODIFIED: Colspan updated to 7 ‚ùáÔ∏è -->
                                            <tr><td colspan="7" class="text-center p-8 text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div id="dashboard-online" class="dashboard-sub-content">
                                <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                                    <h3 class="text-xl font-semibold text-gray-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h3>
                                    <div class="flex flex-wrap items-center justify-end space-x-2 gap-y-2 w-full md:w-auto">
                                        <input type="text" id="search-online" class="border rounded px-3 py-1 w-full md:w-auto" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤... (‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á)">
                                        <input type="text" id="start-date-online" class="date-filter border rounded px-2 py-1 w-36" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
                                        <input type="text" id="end-date-online" class="date-filter border rounded px-2 py-1 w-36" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î">
                                        <button class="print-btn bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center space-x-2" data-table-id="dashboard-table-online-body" data-title="‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå">
                                            <i class="fas fa-print"></i>
                                            <span>‡∏û‡∏¥‡∏°‡∏û‡πå</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="overflow-x-auto border rounded-lg">
                                    <table class="min-w-full">
                                        <thead class="table-header">
                                            <tr>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dashboard-table-online-body" class="divide-y divide-gray-200 bg-white">
                                            <tr><td colspan="6" class="text-center p-8 text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div id="dashboard-requests" class="dashboard-sub-content">
                                <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                                    <h3 class="text-xl font-semibold text-gray-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</h3>
                                    <div class="flex flex-wrap items-center justify-end space-x-2 gap-y-2 w-full md:w-auto">
                                        <input type="text" id="search-requests" class="border rounded px-3 py-1 w-full md:w-auto" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤... (‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á)">
                                        <input type="text" id="start-date-requests" class="date-filter border rounded px-2 py-1 w-36" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
                                        <input type="text" id="end-date-requests" class="date-filter border rounded px-2 py-1 w-36" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î">
                                        <button class="print-btn bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center space-x-2" data-table-id="dashboard-table-requests-body" data-title="‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ">
                                            <i class="fas fa-print"></i>
                                            <span>‡∏û‡∏¥‡∏°‡∏û‡πå</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="overflow-x-auto border rounded-lg">
                                    <table class="min-w-full">
                                        <thead class="table-header">
                                            <tr>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                                <th class="py-3 px-4 text-left font-semibold table-header-text">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dashboard-table-requests-body" class="divide-y divide-gray-200 bg-white">
                                           <tr><td colspan="7" class="text-center p-8 text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Section 5: Announcer -->
                <div id="announcer" class="tab-content">
                    <div class="card glass p-8 rounded-lg shadow-lg">
                        <h2 class="card-title text-xl md:text-2xl font-bold mb-6 border-b-2 pb-4 flex items-center space-x-3">
                            <i class="fas fa-bullhorn text-indigo-600"></i>
                            <span>‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                        </h2>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Current Announcement -->
                            <div class="lg:col-span-2">
                                <h3 class="text-xl font-semibold text-gray-700 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h3>
                                <div id="current-announcement-card" class="bg-indigo-50 p-8 rounded-lg shadow-inner min-h-[300px] flex items-center justify-center">
                                    <!-- Current card will be injected here -->
                                    <p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>
                                </div>
                                <div class="mt-4 flex justify-center space-x-4">
                                    <button id="prev-btn" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 flex items-center space-x-2">
                                        <i class="fas fa-arrow-left"></i> <span>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö (W)</span>
                                    </button>
                                    <button id="next-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 flex items-center space-x-2">
                                        <span>‡∏ï‡πà‡∏≠‡πÑ‡∏õ (E)</span> <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Announced List -->
                            <div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-4">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡πâ‡∏ß</h3>
                                <div id="announced-list" class="space-y-3 max-h-[60vh] overflow-y-auto bg-gray-50 p-4 rounded-lg">
                                    <!-- Announced items will be listed here -->
                                    <p class="text-gray-400 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Login Modal -->
    <div id="login-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h3>
                <div class="mt-2 px-7 py-3">
                    <form id="login-form">
                        <label for="password" class="block text-sm text-left font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</label>
                        <input id="password" type="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™" class="mb-3 px-3 py-2 text-gray-700 bg-white rounded text-md shadow-sm w-full border" required>
                        <p id="login-error" class="text-red-600 text-sm mb-3 hidden">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                        <div class="items-center px-4 py-3">
                            <button id="login-submit-btn" type="submit" class="px-4 py-2 bg-indigo-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-700">
                                ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                            </button>
                        </div>
                    </form>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-modal-btn" type="button" class="px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-300">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal (Recorded Donations) -->
    <div id="edit-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <form id="edit-form">
                <input type="hidden" id="edit-doc-id">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4 border-b pb-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)</h3>
                
                <div class="space-y-6 max-h-[70vh] overflow-y-auto p-4">
                    <!-- Part 1: Donor Info -->
                    <fieldset class="border p-4 rounded-md">
                        <legend class="text-md font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                            <div>
                                <label for="edit-donorType" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                <select id="edit-donorType" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                    <option>‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</option>
                                    <option>‡∏ô‡∏¥‡∏ï‡∏¥‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</option>
                                </select>
                            </div>
                            <div>
                                <label for="edit-idNumber" class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß (13 ‡∏´‡∏•‡∏±‡∏Å)</label>
                                <input id="edit-idNumber" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label for="edit-orgName" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• / ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</label>
                                <input id="edit-orgName" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-phone" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input id="edit-phone" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label for="edit-notes" class="block text-sm font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                                <textarea id="edit-notes" rows="2" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                    </fieldset>
        
                    <!-- Part 2: Donation Details -->
                    <fieldset class="border p-4 rounded-md">
                        <legend class="text-md font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                            <div>
                                <label for="edit-amount" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input id="edit-amount" type="number" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-donationType" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                <input id="edit-donationType" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label for="edit-purpose" class="block text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
                                <select id="edit-purpose" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                    <option value="‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏ó‡∏ö‡∏Å‡∏ê‡∏¥‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2568">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏ó‡∏ö‡∏Å‡∏ê‡∏¥‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2568</option>
                                    <option value="‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
        
                    <!-- Part 3: Documentation -->
                    <fieldset class="border p-4 rounded-md">
                        <legend class="text-md font-semibold px-2 text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</legend>
                        <div class="mt-2">
                            <label for="edit-receiptStatus" class="block text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô</label>
                            <select id="edit-receiptStatus" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                                <option value="‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</option>
                            </select>
                        </div>
                    </fieldset>
                </div>
        
                <div class="items-center px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse mt-4">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 sm:ml-3 sm:w-auto sm:text-sm">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button id="edit-modal-close" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:w-auto sm:text-sm">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Modal (Online Donations) -->
    <div id="edit-online-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <form id="edit-online-form">
                <input type="hidden" id="edit-online-doc-id">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4 border-b pb-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</h3>
                
                <div class="space-y-6 max-h-[70vh] overflow-y-auto p-4">
                    <fieldset class="border p-4 rounded-md">
                        <legend class="text-md font-semibold px-2 text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                            <div class="md:col-span-2">
                                <label for="edit-online-name" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input id="edit-online-name" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-online-amount" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input id="edit-online-amount" type="number" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-online-type" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                <input id="edit-online-type" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label for="edit-online-notes" class="block text-sm font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                                <textarea id="edit-online-notes" rows="2" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
        
                <div class="items-center px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse mt-4">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 sm:ml-3 sm:w-auto sm:text-sm">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button id="edit-online-modal-close" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:w-auto sm:text-sm">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Modal (Tax Receipt Requests) -->
    <div id="edit-request-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <form id="edit-request-form">
                <input type="hidden" id="edit-request-doc-id">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4 border-b pb-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô)</h3>
                
                <div class="space-y-6 max-h-[70vh] overflow-y-auto p-4">
                    <fieldset class="border p-4 rounded-md">
                        <legend class="text-md font-semibold px-2 text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                             <div>
                                <label for="edit-request-taxId" class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ</label>
                                <input id="edit-request-taxId" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                             <div class="md:col-span-2">
                                <label for="edit-request-fullName" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input id="edit-request-fullName" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-request-phone" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input id="edit-request-phone" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-request-amount" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input id="edit-request-amount" type="number" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label for="edit-request-donationType" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</label>
                                <input id="edit-request-donationType" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label for="edit-request-notes" class="block text-sm font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                                <textarea id="edit-request-notes" rows="2" class="mt-1 w-full p-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
        
                <div class="items-center px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse mt-4">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 sm:ml-3 sm:w-auto sm:text-sm">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button id="edit-request-modal-close" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:w-auto sm:text-sm">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = {
                apiKey: "AIzaSyB4K1Th2ApaDTZmXjhkAtPZtI4ZlFUCATU",
                authDomain: "e-donation-9f35d.firebaseapp.com",
                projectId: "e-donation-9f35d",
                storageBucket: "e-donation-9f35d.appspot.com",
                messagingSenderId: "694136323923",
                appId: "1:694136323923:web:aa3f3ca0a6bb1f03ffaba6",
                measurementId: "G-9FW0EN52S1"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();
            
            // --- Thai Baht Text Function ---
            function ThaiBaht(number) {
                let bahttext = "";
                if (isNaN(number) || number === null) {
                    return "";
                }
                
                number = parseFloat(number);
                if (number === 0) {
                    return "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";
                }
    
                let num = Math.floor(number);
                let satang = Math.round((number - num) * 100);
    
                let t = ["", "‡∏™‡∏¥‡∏ö", "‡∏£‡πâ‡∏≠‡∏¢", "‡∏û‡∏±‡∏ô", "‡∏´‡∏°‡∏∑‡πà‡∏ô", "‡πÅ‡∏™‡∏ô", "‡∏•‡πâ‡∏≤‡∏ô"];
                let n = ["", "‡∏´‡∏ô‡∏∂‡πà‡∏á", "‡∏™‡∏≠‡∏á", "‡∏™‡∏≤‡∏°", "‡∏™‡∏µ‡πà", "‡∏´‡πâ‡∏≤", "‡∏´‡∏Å", "‡πÄ‡∏à‡πá‡∏î", "‡πÅ‡∏õ‡∏î", "‡πÄ‡∏Å‡πâ‡∏≤"];
    
                let s = num.toString();
                let s_len = s.length;
    
                let s_rev = s.split('').reverse().join('');
                for (let i = 0; i < s_len; i++) {
                    let digit = s_rev[i];
                    if (digit !== '0') {
                        let unit = t[i];
                        let digitText = n[parseInt(digit)];
    
                        if (i % 6 === 1 && digit === '2') { 
                            digitText = "‡∏¢‡∏µ‡πà";
                        } else if (i % 6 === 1 && digit === '1') { 
                            digitText = "";
                        } else if (i === 0 && digit === '1' && s.length > 1) { 
                            digitText = "‡πÄ‡∏≠‡πá‡∏î";
                        } else if (i % 6 === 0 && i >= 6) {
                            unit = "‡∏•‡πâ‡∏≤‡∏ô";
                        }
                        bahttext = digitText + unit + bahttext;
                    }
                }
                
                bahttext += "‡∏ö‡∏≤‡∏ó";
    
                if (satang > 0) {
                    let satangStr = satang.toString().padStart(2, '0');
                    let s1 = satangStr[0];
                    let s2 = satangStr[1];
    
                    if (s1 !== '0') {
                        bahttext += (s1 === '2' ? '‡∏¢‡∏µ‡πà' : (s1 === '1' ? '' : n[parseInt(s1)])) + '‡∏™‡∏¥‡∏ö';
                    }
                    if (s2 !== '0') {
                        bahttext += (s2 === '1' && s1 !== '0' ? '‡πÄ‡∏≠‡πá‡∏î' : n[parseInt(s2)]);
                    }
                    bahttext += '‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå';
                } else {
                    bahttext += "‡∏ñ‡πâ‡∏ß‡∏ô";
                }
                return bahttext;
            }
    
            // --- DOM Elements ---
            const tabs = document.querySelectorAll('.nav-link');
            const tabContents = document.querySelectorAll('.tab-content');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const loginModal = document.getElementById('login-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');
            const staffMenu = document.getElementById('staff-menu');
            
            const editModal = document.getElementById('edit-modal');
            const editForm = document.getElementById('edit-form');
            const editModalCloseBtn = document.getElementById('edit-modal-close');

            const editOnlineModal = document.getElementById('edit-online-modal');
            const editOnlineForm = document.getElementById('edit-online-form');
            const editOnlineModalCloseBtn = document.getElementById('edit-online-modal-close');

            const editRequestModal = document.getElementById('edit-request-modal');
            const editRequestForm = document.getElementById('edit-request-form');
            const editRequestModalCloseBtn = document.getElementById('edit-request-modal-close');
            
            // --- State Management ---
            let isLoggedIn = false;
    
            // --- Auth State Logic ---
            auth.onAuthStateChanged(user => {
                if (user) {
                    if (!isLoggedIn) { // To avoid re-initializing everything on hot-reload
                        staffMenu.classList.remove('hidden');
                        loginBtn.classList.add('hidden');
                        logoutBtn.classList.remove('hidden');
                        loginModal.classList.add('hidden');
                        loadDashboardData();
                    }
                    isLoggedIn = true;
                } else {
                    if (isLoggedIn) { // Only run unsubscribe if the state changes from logged-in to logged-out
                       unsubscribeAllListeners();
                    }
                    isLoggedIn = false;
                    staffMenu.classList.add('hidden');
                    loginBtn.classList.remove('hidden');
                    logoutBtn.classList.add('hidden');
                    tabs.forEach(item => item.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.querySelector('.nav-link[data-tab="home"]').classList.add('active');
                    document.getElementById('home').classList.add('active');
                }
            });
            
            // --- Login/Logout UI Logic ---
            loginBtn.addEventListener('click', () => loginModal.classList.remove('hidden'));
            closeModalBtn.addEventListener('click', () => {
                loginModal.classList.add('hidden');
                loginError.classList.add('hidden');
            });
            logoutBtn.addEventListener('click', () => auth.signOut());
            
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = "admin@test.com";
                const password = document.getElementById('password').value;
                loginError.classList.add('hidden');
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    document.getElementById('password').value = ''; 
                } catch (error) {
                    console.error("Login failed:", error.code);
                    loginError.textContent = "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
                    loginError.classList.remove('hidden');
                }
            });
    
            // --- Tab Navigation Logic ---
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    if (tab.closest('#staff-menu') && !auth.currentUser) {
                        Swal.fire({
                            title: '‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏£‡∏≤‡∏ö',
                            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô',
                            icon: 'info'
                        });
                        return;
                    }
                    tabs.forEach(item => item.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab)?.classList.add('active');
                });
            });
            
            document.getElementById('home-donate-btn').addEventListener('click', () => {
                document.querySelector('.nav-link[data-tab="donate"]').click();
            });
            document.getElementById('home-receipt-btn').addEventListener('click', () => {
                document.querySelector('.nav-link[data-tab="request-receipt"]').click();
            });
    
            // --- Firestore Data Handling ---
            const donateForm = document.getElementById('donate-form');
            donateForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const typeRadio = document.querySelector('input[name="donation-type-1"]:checked');
                let donationType = typeRadio.value === '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ' ? `‡∏≠‡∏∑‡πà‡∏ô ‡πÜ: ${document.getElementById('other-type-1').value}` : typeRadio.value;
                try {
                    await db.collection("donations").add({
                        name: donateForm['donor-name-1'].value,
                        amount: Number(donateForm['amount-1'].value),
                        type: donationType,
                        notes: donateForm['notes-1'].value,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                    donateForm.reset();
                } catch (error) {
                    console.error("Error adding document: ", error);
                    Swal.fire({
                        title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        icon: 'error'
                    });
                }
            });
    
            const recordForm = document.getElementById('record-form');
            recordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const typeRadio = document.querySelector('input[name="donation-type-2"]:checked');
                let donationType = typeRadio.value === '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ' ? `‡∏≠‡∏∑‡πà‡∏ô ‡πÜ: ${document.getElementById('other-type-2').value}` : typeRadio.value;
                const receiptStatus = document.querySelector('input[name="receipt-request"]:checked').value === 'yes' ? '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : '‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£';
                try {
                    await db.collection("recorded_donations").add({
                        donorType: recordForm['donor-type-2'].value,
                        idNumber: recordForm['id-number-2'].value,
                        orgName: recordForm['org-name-2'].value,
                        phone: recordForm['phone-2'].value,
                        notes: recordForm['notes-2'].value,
                        donationType: donationType,
                        amount: Number(recordForm['amount-2'].value),
                        purpose: recordForm['purpose-2'].value,
                        receiptStatus: receiptStatus,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                    recordForm.reset();
                } catch (error) {
                    console.error("Error adding document: ", error);
                    Swal.fire({
                        title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        icon: 'error'
                    });
                }
            });
            
            const requestReceiptForm = document.getElementById('request-receipt-form');
            requestReceiptForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const typeRadio = document.querySelector('input[name="donation-type-3"]:checked');
                let donationType = typeRadio.value === '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ' ? `‡∏≠‡∏∑‡πà‡∏ô ‡πÜ: ${document.getElementById('other-type-3').value}` : typeRadio.value;
                try {
                    await db.collection("tax_receipt_requests").add({
                        taxId: requestReceiptForm['tax-id-3'].value,
                        fullName: requestReceiptForm['fullname-3'].value,
                        phone: requestReceiptForm['phone-3'].value,
                        donationType: donationType,
                        amount: Number(requestReceiptForm['amount-3'].value),
                        notes: requestReceiptForm['notes-3'].value,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                    requestReceiptForm.reset();
                } catch (error) {
                    console.error("Error adding document: ", error);
                    Swal.fire({
                        title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        icon: 'error'
                    });
                }
            });
    
            // --- Dashboard Data Loading & Filtering ---
            let unsubscribeRecorded = null, unsubscribeOnline = null, unsubscribeRequests = null, unsubscribeAnnouncer = null, unsubscribeOnlineAnnouncer = null;
            let allDocsData = {}; // Cache for editing
            let allRecordedData = [], allOnlineData = [], allRequestData = [], allAnnouncerData = [];
    
            function unsubscribeAllListeners() {
                if (unsubscribeRecorded) unsubscribeRecorded();
                if (unsubscribeOnline) unsubscribeOnline();
                if (unsubscribeRequests) unsubscribeRequests();
                if (unsubscribeAnnouncer) unsubscribeAnnouncer();
                if (unsubscribeOnlineAnnouncer) unsubscribeOnlineAnnouncer();
            }
    
            function loadDashboardData() {
                unsubscribeAllListeners();
                const datePickerOnChange = () => {
                    renderRecordedTable();
                    renderOnlineTable();
                    renderRequestsTable();
                };
    
                const fpConfig = { dateFormat: "Y-m-d", onChange: datePickerOnChange };
                flatpickr("#start-date-recorded", fpConfig);
                flatpickr("#end-date-recorded", fpConfig);
                flatpickr("#start-date-online", fpConfig);
                flatpickr("#end-date-online", fpConfig);
                flatpickr("#start-date-requests", fpConfig);
                flatpickr("#end-date-requests", fpConfig);
                
                const searchRecorded = document.getElementById('search-recorded');
                const searchOnline = document.getElementById('search-online');
                const searchRequests = document.getElementById('search-requests');

                if (searchRecorded) searchRecorded.addEventListener('input', datePickerOnChange);
                if (searchOnline) searchOnline.addEventListener('input', datePickerOnChange);
                if (searchRequests) searchRequests.addEventListener('input', datePickerOnChange);

                const mergeAndRender = () => {
                    const combined = [...allRecordedData, ...allOnlineData];
                    renderHomePage(combined);
                };
    
                const recordedRef = db.collection("recorded_donations").orderBy("createdAt", "desc");
                unsubscribeRecorded = recordedRef.onSnapshot((snapshot) => {
                    allRecordedData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const recordedDocs = allRecordedData.reduce((acc, doc) => ({...acc, [doc.id]: doc }), {});
                    allDocsData = { ...allDocsData, ...recordedDocs };
                    renderRecordedTable();
                    mergeAndRender();
                }, console.error);
    
                const onlineRef = db.collection("donations").orderBy("createdAt", "desc");
                unsubscribeOnline = onlineRef.onSnapshot((snapshot) => {
                    allOnlineData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const onlineDocs = allOnlineData.reduce((acc, doc) => ({...acc, [doc.id]: doc }), {});
                    allDocsData = { ...allDocsData, ...onlineDocs };
                    renderOnlineTable();
                    mergeAndRender();
                }, console.error);
    
                const requestsRef = db.collection("tax_receipt_requests").orderBy("createdAt", "desc");
                unsubscribeRequests = requestsRef.onSnapshot((snapshot) => {
                    allRequestData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const requestDocs = allRequestData.reduce((acc, doc) => ({...acc, [doc.id]: doc }), {});
                    allDocsData = { ...allDocsData, ...requestDocs };
                    renderRequestsTable();
                }, console.error);
    
                const announcerRecordedRef = db.collection("recorded_donations").orderBy("createdAt", "asc");
                const announcerOnlineRef = db.collection("donations").orderBy("createdAt", "asc");
    
                let recordedAnnouncerData = [];
                let onlineAnnouncerData = [];
    
                const mergeAndRenderAnnouncer = () => {
                    const combined = [...recordedAnnouncerData, ...onlineAnnouncerData];
                    combined.sort((a, b) => a.createdAt.seconds - b.createdAt.seconds);
                    allAnnouncerData = combined;
                    renderAnnouncerView();
                };
    
                unsubscribeAnnouncer = announcerRecordedRef.onSnapshot((snapshot) => {
                    recordedAnnouncerData = snapshot.docs.map(doc => ({ id: doc.id, collection: 'recorded_donations', name: doc.data().orgName, ...doc.data() }));
                    mergeAndRenderAnnouncer();
                }, console.error);
                
                unsubscribeOnlineAnnouncer = announcerOnlineRef.onSnapshot((snapshot) => {
                     onlineAnnouncerData = snapshot.docs.map(doc => ({ id: doc.id, collection: 'donations', orgName: doc.data().name, donationType: doc.data().type, ...doc.data() }));
                     mergeAndRenderAnnouncer();
                }, console.error);
            }
    
            function filterDataByDate(data, startDate, endDate) {
                if (endDate) endDate.setHours(23, 59, 59, 999);
                return data.filter(item => {
                    const itemDate = item.createdAt?.toDate();
                    if (!itemDate) return false;
                    const startMatch = startDate ? itemDate >= startDate : true;
                    const endMatch = endDate ? itemDate <= endDate : true;
                    return startMatch && endMatch;
                });
            }
            
            let homeCountUp; 
    
            function renderHomePage(combinedData) {
                const totalAmount = combinedData.reduce((sum, item) => sum + (item.amount || 0), 0);
                const homeTotalAmountEl = document.getElementById('home-total-amount');
    
                if (!homeCountUp) {
                    homeCountUp = new countUp.CountUp(homeTotalAmountEl, totalAmount, {
                        prefix: '‡∏ø ',
                        decimalPlaces: 2,
                        duration: 2.5,
                        separator: ',',
                    });
                    if (!homeCountUp.error) {
                        homeCountUp.start();
                    } else {
                        console.error(homeCountUp.error);
                        homeTotalAmountEl.textContent = `‡∏ø ${totalAmount.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    }
                } else {
                    homeCountUp.update(totalAmount);
                }
    
                const recentDonations = combinedData.sort((a, b) => b.createdAt.seconds - a.createdAt.seconds).slice(0, 5);
                const recentList = document.getElementById('recent-donations-list');
                recentList.innerHTML = '';
                if(recentDonations.length > 0) {
                    recentDonations.forEach(item => {
                        recentList.innerHTML += `
                            <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center transition-all duration-300 hover:bg-indigo-50">
                                <div>
                                    <p class="font-bold text-gray-800 text-lg">${item.orgName || item.name}</p>
                                    <p class="text-sm text-gray-500">${formatFirebaseTimestamp(item.createdAt)}</p>
                                </div>
                                <span class="font-bold text-green-600 text-xl">${(item.amount || 0).toLocaleString('th-TH')} ‡∏ø</span>
                            </div>
                        `;
                    });
                } else {
                    recentList.innerHTML = '<p class="text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</p>';
                }
            }
    
            // ‚ùáÔ∏è MODIFIED: Updated search logic and table row generation ‚ùáÔ∏è
            function renderRecordedTable() {
                const startDate = document.getElementById('start-date-recorded')._flatpickr.selectedDates[0];
                const endDate = document.getElementById('end-date-recorded')._flatpickr.selectedDates[0];
                const searchTerm = document.getElementById('search-recorded').value.toLowerCase();
                let filteredData = filterDataByDate(allRecordedData, startDate, endDate);

                if (searchTerm) {
                    filteredData = filteredData.filter(data => {
                        return (
                            (data.orgName && data.orgName.toLowerCase().includes(searchTerm)) ||
                            (data.amount && data.amount.toString().toLowerCase().includes(searchTerm)) ||
                            (data.donationType && data.donationType.toLowerCase().includes(searchTerm)) ||
                            (data.notes && data.notes.toLowerCase().includes(searchTerm)) || // Added notes
                            (data.receiptStatus && data.receiptStatus.toLowerCase().includes(searchTerm)) ||
                            (data.phone && data.phone.toLowerCase().includes(searchTerm)) ||
                            (data.idNumber && data.idNumber.toLowerCase().includes(searchTerm)) ||
                            (formatFirebaseTimestamp(data.createdAt).toLowerCase().includes(searchTerm)) // Added date
                        );
                    });
                }

                const tableBody = document.getElementById('dashboard-table-recorded-body');
                tableBody.innerHTML = '';
    
                if (filteredData.length === 0) {
                     tableBody.innerHTML = '<tr><td colspan="7" class="text-center p-8 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td></tr>';
                } else {
                    filteredData.forEach(data => {
                        tableBody.innerHTML += `
                            <tr class="hover-row" data-id="${data.id}">
                                <td class="py-3 px-4">${formatFirebaseTimestamp(data.createdAt)}</td>
                                <td class="py-3 px-4">${data.orgName}</td>
                                <td class="py-3 px-4 text-right">${(data.amount || 0).toLocaleString('th-TH')}</td>
                                <td class="py-3 px-4">${data.donationType}</td>
                                <td class="py-3 px-4">${data.notes || ''}</td>
                                <td class="py-3 px-4">${renderStatusBadge(data.receiptStatus)}</td>
                                <td class="py-3 px-4 text-center space-x-4">
                                    <button class="text-indigo-600 hover:text-indigo-800 edit-btn" data-collection="recorded_donations" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"><i class="fas fa-edit"></i></button>
                                    <button class="text-red-600 hover:text-red-800 delete-btn" title="‡∏•‡∏ö" data-collection="recorded_donations"><i class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>`;
                    });
                }
                 // Update global stats based on unfiltered data
                let recordedTotal = allRecordedData.reduce((sum, item) => sum + (item.amount || 0), 0);
                let onlineTotal = allOnlineData.reduce((sum, item) => sum + (item.amount || 0), 0);
                
                document.getElementById('total-donation-amount').textContent = `‡∏ø ${(recordedTotal + onlineTotal).toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                document.getElementById('total-donors').textContent = `${allRecordedData.length} ‡∏Ñ‡∏ô`;
                document.getElementById('pending-receipts').textContent = `${allRecordedData.filter(d => d.receiptStatus === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£').length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            }
    
            function renderOnlineTable() {
                const startDate = document.getElementById('start-date-online')._flatpickr.selectedDates[0];
                const endDate = document.getElementById('end-date-online')._flatpickr.selectedDates[0];
                const searchTerm = document.getElementById('search-online').value.toLowerCase();
                let filteredData = filterDataByDate(allOnlineData, startDate, endDate);

                if (searchTerm) {
                    filteredData = filteredData.filter(data => {
                        return (
                            (data.name && data.name.toLowerCase().includes(searchTerm)) ||
                            (data.amount && data.amount.toString().toLowerCase().includes(searchTerm)) ||
                            (data.type && data.type.toLowerCase().includes(searchTerm)) ||
                            (data.notes && data.notes.toLowerCase().includes(searchTerm)) ||
                            (formatFirebaseTimestamp(data.createdAt).toLowerCase().includes(searchTerm))
                        );
                    });
                }

                const tableBody = document.getElementById('dashboard-table-online-body');
                tableBody.innerHTML = '';
    
                if (filteredData.length === 0) {
                     tableBody.innerHTML = '<tr><td colspan="6" class="text-center p-8 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td></tr>';
                } else {
                     filteredData.forEach(data => {
                         tableBody.innerHTML += `
                            <tr class="hover-row" data-id="${data.id}">
                                <td class="py-3 px-4">${formatFirebaseTimestamp(data.createdAt)}</td>
                                <td class="py-3 px-4">${data.name}</td>
                                <td class="py-3 px-4 text-right">${(data.amount || 0).toLocaleString('th-TH')}</td>
                                <td class="py-3 px-4">${data.type}</td>
                                <td class="py-3 px-4">${data.notes || ''}</td>
                                <td class="py-3 px-4 text-center space-x-4">
                                    <button class="text-indigo-600 hover:text-indigo-800 edit-btn" data-collection="donations" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"><i class="fas fa-edit"></i></button>
                                    <button class="text-red-600 hover:text-red-800 delete-btn" title="‡∏•‡∏ö" data-collection="donations"><i class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>`;
                    });
                }
            }
    
            function renderRequestsTable() {
                const startDate = document.getElementById('start-date-requests')._flatpickr.selectedDates[0];
                const endDate = document.getElementById('end-date-requests')._flatpickr.selectedDates[0];
                const searchTerm = document.getElementById('search-requests').value.toLowerCase();
                let filteredData = filterDataByDate(allRequestData, startDate, endDate);

                if (searchTerm) {
                    filteredData = filteredData.filter(data => {
                        return (
                            (data.taxId && data.taxId.toLowerCase().includes(searchTerm)) ||
                            (data.fullName && data.fullName.toLowerCase().includes(searchTerm)) ||
                            (data.phone && data.phone.toLowerCase().includes(searchTerm)) ||
                            (data.amount && data.amount.toString().toLowerCase().includes(searchTerm)) ||
                            (data.donationType && data.donationType.toLowerCase().includes(searchTerm)) ||
                            (formatFirebaseTimestamp(data.createdAt).toLowerCase().includes(searchTerm))
                        );
                    });
                }

                const tableBody = document.getElementById('dashboard-table-requests-body');
                tableBody.innerHTML = '';
                document.getElementById('total-receipt-requests').textContent = `${allRequestData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    
                if (filteredData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center p-8 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td></tr>';
                } else {
                    filteredData.forEach(data => {
                        tableBody.innerHTML += `
                             <tr class="hover-row" data-id="${data.id}">
                                <td class="py-3 px-4">${formatFirebaseTimestamp(data.createdAt)}</td>
                                <td class="py-3 px-4">${data.taxId}</td>
                                <td class="py-3 px-4">${data.fullName}</td>
                                <td class="py-3 px-4 text-right">${(data.amount || 0).toLocaleString('th-TH')}</td>
                                <td class="py-3 px-4">${data.donationType}</td>
                                <td class="py-3 px-4">${data.phone}</td>
                                <td class="py-3 px-4 text-center space-x-4">
                                    <button class="text-indigo-600 hover:text-indigo-800 edit-btn" data-collection="tax_receipt_requests" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"><i class="fas fa-edit"></i></button>
                                    <button class="text-red-600 hover:text-red-800 delete-btn" title="‡∏•‡∏ö" data-collection="tax_receipt_requests"><i class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>`;
                    });
                }
            }
    
            function renderAnnouncerView() {
                const unannounced = allAnnouncerData.filter(d => !d.announced);
                const announced = allAnnouncerData.filter(d => d.announced);
    
                const currentCardContainer = document.getElementById('current-announcement-card');
                const announcedListContainer = document.getElementById('announced-list');
    
                // Render current announcement
                if (unannounced.length > 0) {
                    const current = unannounced[0];
                     currentCardContainer.innerHTML = `
                        <div class="text-left w-full space-y-4" data-id="${current.id}" data-collection="${current.collection}">
                            <div>
                                <p class="text-2xl text-gray-600">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ:</p>
                                <p class="text-5xl font-bold text-indigo-700" style="word-break: break-word;">${current.orgName || current.name}</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                   <p class="text-xl text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</p>
                                   <p class="text-3xl font-semibold text-green-600">${(current.amount || 0).toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó</p>
                                </div>
                                <div>
                                   <p class="text-xl text-gray-600">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</p>
                                   <p class="text-3xl font-semibold text-gray-800">${current.donationType || current.type}</p>
                                </div>
                            </div>
                            <div>
                                <p class="text-xl text-gray-600">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</p>
                                <p class="text-2xl text-gray-800">${current.notes || '-'}</p>
                            </div>
                        </div>
                    `;
                } else {
                    currentCardContainer.innerHTML = '<p class="text-gray-500 text-2xl">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>';
                }
    
                // Render announced list
                announcedListContainer.innerHTML = '';
                if (announced.length > 0) {
                    announced.slice().reverse().forEach(item => { // Show most recent announced first
                        announcedListContainer.innerHTML += `
                            <div class="bg-white p-3 rounded-md shadow-sm flex justify-between items-center">
                                <span class="text-gray-800">${item.orgName || item.name}</span>
                                <span class="font-semibold text-green-700">${(item.amount || 0).toLocaleString('th-TH')} ‡∏ø</span>
                            </div>
                        `;
                    });
                } else {
                    announcedListContainer.innerHTML = '<p class="text-gray-400 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>';
                }
            }
    
            function formatFirebaseTimestamp(timestamp) {
                return timestamp ? new Date(timestamp.seconds * 1000).toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A';
            }
            
            // --- Dashboard Edit/Delete Logic ---
            document.getElementById('dashboard').addEventListener('click', async (e) => {
                const target = e.target.closest('button');
                if (!target) return;
    
                const row = target.closest('tr');
                if (!row) return;
                const id = row.dataset.id;
                const collectionName = target.dataset.collection;
    
                if (target.classList.contains('delete-btn')) {
                    Swal.fire({
                        title: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`, icon: 'warning',
                        showCancelButton: true, confirmButtonColor: '#4f46e5', cancelButtonColor: '#d33',
                        confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                await db.collection(collectionName).doc(id).delete();
                                Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß!', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                            } catch (err) {
                                Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                                console.error(err);
                            }
                        }
                    });
                }
                
                if (target.classList.contains('edit-btn')) {
                    const data = allDocsData[id];
                    if (!data) {
                        console.error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ID:", id);
                        return;
                    }

                    if (collectionName === 'recorded_donations') {
                        document.getElementById('edit-doc-id').value = id;
                        document.getElementById('edit-donorType').value = data.donorType;
                        document.getElementById('edit-idNumber').value = data.idNumber;
                        document.getElementById('edit-orgName').value = data.orgName;
                        document.getElementById('edit-phone').value = data.phone;
                        document.getElementById('edit-notes').value = data.notes;
                        document.getElementById('edit-amount').value = data.amount;
                        document.getElementById('edit-donationType').value = data.donationType;
                        document.getElementById('edit-purpose').value = data.purpose;
                        document.getElementById('edit-receiptStatus').value = data.receiptStatus;
                        editModal.classList.remove('hidden');
                    } else if (collectionName === 'donations') {
                        document.getElementById('edit-online-doc-id').value = id;
                        document.getElementById('edit-online-name').value = data.name;
                        document.getElementById('edit-online-amount').value = data.amount;
                        document.getElementById('edit-online-type').value = data.type;
                        document.getElementById('edit-online-notes').value = data.notes;
                        editOnlineModal.classList.remove('hidden');
                    } else if (collectionName === 'tax_receipt_requests') {
                        document.getElementById('edit-request-doc-id').value = id;
                        document.getElementById('edit-request-taxId').value = data.taxId;
                        document.getElementById('edit-request-fullName').value = data.fullName;
                        document.getElementById('edit-request-phone').value = data.phone;
                        document.getElementById('edit-request-donationType').value = data.donationType;
                        document.getElementById('edit-request-amount').value = data.amount;
                        document.getElementById('edit-request-notes').value = data.notes;
                        editRequestModal.classList.remove('hidden');
                    }
                }
            });
            
            // --- Edit Modal Logic ---
            editModalCloseBtn.addEventListener('click', () => {
                editModal.classList.add('hidden');
            });
            
            editOnlineModalCloseBtn.addEventListener('click', () => {
                editOnlineModal.classList.add('hidden');
            });

            editRequestModalCloseBtn.addEventListener('click', () => {
                editRequestModal.classList.add('hidden');
            });
    
            editForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const id = document.getElementById('edit-doc-id').value;
                const updatedData = {
                    donorType: document.getElementById('edit-donorType').value,
                    idNumber: document.getElementById('edit-idNumber').value,
                    orgName: document.getElementById('edit-orgName').value,
                    phone: document.getElementById('edit-phone').value,
                    notes: document.getElementById('edit-notes').value,
                    amount: Number(document.getElementById('edit-amount').value),
                    donationType: document.getElementById('edit-donationType').value,
                    purpose: document.getElementById('edit-purpose').value,
                    receiptStatus: document.getElementById('edit-receiptStatus').value
                };
                
                try {
                    await db.collection("recorded_donations").doc(id).update(updatedData);
                    editModal.classList.add('hidden');
                    Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', icon: 'success',
                        timer: 1500, showConfirmButton: false
                    });
                } catch (err) {
                     Swal.fire({ title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', icon: 'error' });
                    console.error(err);
                }
            });

            editOnlineForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const id = document.getElementById('edit-online-doc-id').value;
                const updatedData = {
                    name: document.getElementById('edit-online-name').value,
                    amount: Number(document.getElementById('edit-online-amount').value),
                    type: document.getElementById('edit-online-type').value,
                    notes: document.getElementById('edit-online-notes').value
                };
                
                try {
                    await db.collection("donations").doc(id).update(updatedData);
                    editOnlineModal.classList.add('hidden');
                    Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', icon: 'success',
                        timer: 1500, showConfirmButton: false
                    });
                } catch (err) {
                     Swal.fire({ title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', icon: 'error' });
                    console.error(err);
                }
            });

            editRequestForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const id = document.getElementById('edit-request-doc-id').value;
                const updatedData = {
                    taxId: document.getElementById('edit-request-taxId').value,
                    fullName: document.getElementById('edit-request-fullName').value,
                    phone: document.getElementById('edit-request-phone').value,
                    donationType: document.getElementById('edit-request-donationType').value,
                    amount: Number(document.getElementById('edit-request-amount').value),
                    notes: document.getElementById('edit-request-notes').value
                };
                
                try {
                    await db.collection("tax_receipt_requests").doc(id).update(updatedData);
                    editRequestModal.classList.add('hidden');
                    Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', icon: 'success',
                        timer: 1500, showConfirmButton: false
                    });
                } catch (err) {
                     Swal.fire({ title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', icon: 'error' });
                    console.error(err);
                }
            });
    
            function renderStatusBadge(status) {
                if (status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') return `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>`;
                if (status === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') return `<span class="bg-orange-100 text-orange-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>`;
                return `<span class="bg-gray-100 text-gray-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</span>`;
            }
            
            // --- Form Logic ---
            const receiptRadios = document.querySelectorAll('input[name="receipt-request"]');
            const statusDisplay = document.getElementById('status-display');
            receiptRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'yes') {
                        statusDisplay.textContent = '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                        statusDisplay.className = 'ml-2 font-bold text-lg text-yellow-800';
                    } else {
                        statusDisplay.textContent = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                        statusDisplay.className = 'ml-2 font-bold text-lg text-green-700';
                    }
                });
            });
    
            const consentRevenue = document.getElementById('consent-revenue');
            const consentTruth = document.getElementById('consent-truth');
            const submitReceiptButton = document.getElementById('submit-receipt-request');
    
            function checkConsent() {
                submitReceiptButton.disabled = !(consentRevenue.checked && consentTruth.checked);
            }
            
            if (consentRevenue && consentTruth) {
                checkConsent();
                consentRevenue.addEventListener('change', checkConsent);
                consentTruth.addEventListener('change', checkConsent);
            }
    
            // --- Dashboard Sub-Tab Navigation Logic ---
            const dashboardTabs = document.querySelectorAll('.dashboard-nav-link');
            const dashboardContents = document.querySelectorAll('.dashboard-sub-content');
    
            dashboardTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    dashboardTabs.forEach(item => item.classList.remove('active'));
                    dashboardContents.forEach(content => content.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`dashboard-${tab.dataset.subtab}`)?.classList.add('active');
                });
            });
    
            // ‚ùáÔ∏è MODIFIED: Print logic updated to use search filters ‚ùáÔ∏è
            document.querySelectorAll('.print-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const tableId = button.dataset.tableId;
                    const title = button.dataset.title;
                    const tableType = tableId.split('-')[2]; // 'recorded', 'online', or 'requests'

                    // Get date filters
                    const startDateEl = document.getElementById(`start-date-${tableType}`);
                    const endDateEl = document.getElementById(`end-date-${tableType}`);
                    const startDateVal = startDateEl ? startDateEl.value : null;
                    const endDateVal = endDateEl ? endDateEl.value : null;

                    // Get search filter
                    const searchEl = document.getElementById(`search-${tableType}`);
                    const searchTerm = searchEl ? searchEl.value.toLowerCase() : '';

                    let dataToPrint;
                    if (tableType === 'recorded') dataToPrint = allRecordedData;
                    else if (tableType === 'online') dataToPrint = allOnlineData;
                    else if (tableType === 'requests') dataToPrint = allRequestData;
                    else return;
                    
                    // 1. Filter by date first
                    let filteredData = filterDataByDate(dataToPrint, startDateVal ? new Date(startDateVal) : null, endDateVal ? new Date(endDateVal) : null);

                    // 2. Then filter by search term
                    if (searchTerm) {
                        if (tableType === 'recorded') {
                             filteredData = filteredData.filter(data => {
                                return (
                                    (data.orgName && data.orgName.toLowerCase().includes(searchTerm)) ||
                                    (data.amount && data.amount.toString().toLowerCase().includes(searchTerm)) ||
                                    (data.donationType && data.donationType.toLowerCase().includes(searchTerm)) ||
                                    (data.notes && data.notes.toLowerCase().includes(searchTerm)) ||
                                    (data.receiptStatus && data.receiptStatus.toLowerCase().includes(searchTerm)) ||
                                    (data.phone && data.phone.toLowerCase().includes(searchTerm)) ||
                                    (data.idNumber && data.idNumber.toLowerCase().includes(searchTerm)) ||
                                    (formatFirebaseTimestamp(data.createdAt).toLowerCase().includes(searchTerm))
                                );
                            });
                        } else if (tableType === 'online') {
                            filteredData = filteredData.filter(data => {
                                return (
                                    (data.name && data.name.toLowerCase().includes(searchTerm)) ||
                                    (data.amount && data.amount.toString().toLowerCase().includes(searchTerm)) ||
                                    (data.type && data.type.toLowerCase().includes(searchTerm)) ||
                                    (data.notes && data.notes.toLowerCase().includes(searchTerm)) ||
                                    (formatFirebaseTimestamp(data.createdAt).toLowerCase().includes(searchTerm))
                                );
                            });
                        } else if (tableType === 'requests') {
                            filteredData = filteredData.filter(data => {
                                return (
                                    (data.taxId && data.taxId.toLowerCase().includes(searchTerm)) ||
                                    (data.fullName && data.fullName.toLowerCase().includes(searchTerm)) ||
                                    (data.phone && data.phone.toLowerCase().includes(searchTerm)) ||
                                    (data.amount && data.amount.toString().toLowerCase().includes(searchTerm)) ||
                                    (data.donationType && data.donationType.toLowerCase().includes(searchTerm)) ||
                                    (formatFirebaseTimestamp(data.createdAt).toLowerCase().includes(searchTerm))
                                );
                            });
                        }
                    }

                    let tableHeadHTML = '';
                    let tableBodyHTML = '';
                    let totalAmount = 0;
    
                    // Generate table based on ID and filtered data
                    if (tableType === 'recorded') {
                        tableHeadHTML = `<tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô</th></tr>`;
                        filteredData.forEach(item => {
                            totalAmount += item.amount || 0;
                            tableBodyHTML += `<tr><td>${formatFirebaseTimestamp(item.createdAt)}</td><td>${item.orgName}</td><td style="text-align: right;">${(item.amount || 0).toLocaleString('th-TH')}</td><td>${item.donationType}</td><td>${item.notes || ''}</td><td>${item.receiptStatus}</td></tr>`;
                        });
                        tableBodyHTML += `<tr style="font-weight: bold; background-color: #f3f4f6;"><td colspan="2" style="text-align: right;">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td><td style="text-align: right;">${totalAmount.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td><td colspan="3" style="text-align: center;">(${ThaiBaht(totalAmount)})</td></tr>`;
                    } else if (tableType === 'online') {
                        tableHeadHTML = `<tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr>`;
                        filteredData.forEach(item => {
                            totalAmount += item.amount || 0;
                            tableBodyHTML += `<tr><td>${formatFirebaseTimestamp(item.createdAt)}</td><td>${item.name}</td><td style="text-align: right;">${(item.amount || 0).toLocaleString('th-TH')}</td><td>${item.type}</td><td>${item.notes || ''}</td></tr>`;
                        });
                        tableBodyHTML += `<tr style="font-weight: bold; background-color: #f3f4f6;"><td colspan="2" style="text-align: right;">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td><td style="text-align: right;">${totalAmount.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td><td colspan="2" style="text-align: center;">(${ThaiBaht(totalAmount)})</td></tr>`;
                    } else if (tableType === 'requests') {
                        tableHeadHTML = `<tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠</th><th>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr>`;
                         filteredData.forEach(item => {
                            totalAmount += item.amount || 0;
                            tableBodyHTML += `<tr><td>${formatFirebaseTimestamp(item.createdAt)}</td><td>${item.taxId}</td><td>${item.fullName}</td><td>${item.phone}</td><td style="text-align: right;">${(item.amount || 0).toLocaleString('th-TH')}</td><td>${item.donationType}</td><td>${item.notes || ''}</td></tr>`;
                        });
                         tableBodyHTML += `<tr style="font-weight: bold; background-color: #f3f4f6;"><td colspan="4" style="text-align: right;">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td><td style="text-align: right;">${totalAmount.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td><td colspan="2" style="text-align: center;">(${ThaiBaht(totalAmount)})</td></tr>`;
                    }
    
    
                    const printWindow = window.open('', '', 'height=600,width=800');
                    printWindow.document.write('<html><head><title>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</title>');
                    printWindow.document.write('<script src="https://cdn.tailwindcss.com"><\/script>');
                     printWindow.document.write(`<style> body { font-family: 'Sarabun', sans-serif; } table { width: 100%; border-collapse: collapse; font-size: 12px; } th, td { border: 1px solid #ddd; padding: 8px; text-align: left;} th { background-color: #f2f2f2; } </style>`);
                    printWindow.document.write('</head><body >');
                    printWindow.document.write('<div class="container mx-auto p-8">');
                    printWindow.document.write('<div class="text-center mb-8">');
                    printWindow.document.write('<img src="https://img2.pic.in.th/pic/-Ver.3-1.png" alt="logo" class="h-24 w-24 mx-auto">');
                    printWindow.document.write(`<h1 class="text-2xl font-bold mt-4">${title}</h1>`);
                    printWindow.document.write(`<p>‡∏ß‡∏±‡∏î‡πÑ‡∏ä‡∏¢‡∏≤‡∏°‡∏≤‡∏ï‡∏¢‡πå</p>`);
                     if(startDateVal || endDateVal) {
                         printWindow.document.write(`<p>‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${startDateVal || '...'} ‡∏ñ‡∏∂‡∏á ${endDateVal || '...'}</p>`);
                     }
                     if (searchTerm) {
                         printWindow.document.write(`<p>‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${searchEl.value}"</p>`);
                    }
                    printWindow.document.write(`<p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric'})}</p>`);
                    printWindow.document.write('</div>');
                    
                    if (filteredData.length > 0) {
                        printWindow.document.write('<table>');
                        printWindow.document.write(`<thead>${tableHeadHTML}</thead>`);
                        printWindow.document.write(`<tbody>${tableBodyHTML}</tbody>`);
                        printWindow.document.write('</table>');
                    } else {
                        printWindow.document.write('<p class="text-center text-gray-500 mt-8">-- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏ --</p>');
                    }
                    
                    printWindow.document.write('</div>');
                    printWindow.document.write('</body></html>');
                    printWindow.document.close();
                    
                    setTimeout(() => {
                        printWindow.print();
                        printWindow.close();
                    }, 500);
                });
            });
    
            // --- Announcer Logic ---
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');
    
            async function handleNextAnnouncement() {
                const unannounced = allAnnouncerData.filter(d => !d.announced);
                if (unannounced.length > 0) {
                    const docToUpdate = unannounced[0];
                    try {
                        await db.collection(docToUpdate.collection).doc(docToUpdate.id).update({ announced: true });
                        const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 1500, timerProgressBar: true });
                        Toast.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡πâ‡∏ß' });
                    } catch (err) {
                        console.error("Error updating announcement status:", err);
                        Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ', 'error');
                    }
                }
            }
    
            async function handlePreviousAnnouncement() {
                const announced = allAnnouncerData.filter(d => d.announced);
                if (announced.length > 0) {
                    const lastAnnouncedItem = announced.slice().sort((a, b) => b.createdAt.seconds - a.createdAt.seconds)[0];
                    const docId = lastAnnouncedItem.id;
                    const collectionName = lastAnnouncedItem.collection;
                    try {
                        await db.collection(collectionName).doc(docId).update({ announced: false });
                        const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 1500, timerProgressBar: true });
                        Toast.fire({ icon: 'info', title: '‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß' });
                    } catch (err) {
                        console.error("Error reverting announcement status:", err);
                        Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ', 'error');
                    }
                }
            }
    
            nextBtn.addEventListener('click', handleNextAnnouncement);
            prevBtn.addEventListener('click', handlePreviousAnnouncement);
            
            document.addEventListener('keydown', async (e) => {
                const announcerTab = document.getElementById('announcer');
                if (!announcerTab.classList.contains('active') || !auth.currentUser) return;
    
                if (e.key === 'PageDown' || e.key.toLowerCase() === 'e') {
                    e.preventDefault();
                    handleNextAnnouncement();
                }
    
                if (e.key.toLowerCase() === 'w') {
                    e.preventDefault();
                    handlePreviousAnnouncement();
                }
            });
    
            // --- Mobile Menu Logic ---
            const menuBtn = document.getElementById('menu-btn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
    
            menuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
                sidebar.classList.toggle('translate-x-0');
                overlay.classList.toggle('hidden');
            });
    
            overlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                sidebar.classList.remove('translate-x-0');
                overlay.classList.add('hidden');
            });
    
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) { // md breakpoint
                        sidebar.classList.add('-translate-x-full');
                        sidebar.classList.remove('translate-x-0');
                        overlay.classList.add('hidden');
                    }
                });
            });
        });
    </script>
</body>
</html>

